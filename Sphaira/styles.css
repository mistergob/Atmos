:root{
  /* Palette ATMOS */
  --primary:#00eaff;          /* cyan néon */
  --accent:#8a2be2;           /* violet néon */
  --text:#e6f7ff;
  --muted:#9fb3c8;

  /* Fond spatial */
  --space-img:url("https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?q=80&w=1920&auto=format&fit=crop");
  --bg-a:#05060d; --bg-b:#0b1430; --bg-c:#00182a;

  /* Effets */
  --glow: drop-shadow(0 0 8px rgba(0,234,255,.55)) drop-shadow(0 0 18px rgba(138,43,226,.35));
  --ring: 0 0 0 3px rgba(0,234,255,.35), 0 0 24px rgba(0,234,255,.25);

  /* Layout */
  --sidebar-w:260px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Outfit, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color:var(--text);
  user-select:none;
  overflow:hidden;
  background:
    radial-gradient(1200px 800px at 75% 10%, rgba(138,43,226,.18), transparent 60%),
    radial-gradient(900px 700px at 15% 85%, rgba(0,234,255,.12), transparent 55%),
    radial-gradient(700px 500px at 80% 80%, rgba(0,40,80,.35), transparent 60%),
    linear-gradient(120deg, var(--bg-a), var(--bg-b) 40%, var(--bg-c));
}

/* Couche étoiles + image (décor) */
body::before{
  content:"";
  position:fixed; inset:0; pointer-events:none; mix-blend-mode:screen; opacity:.15;
  background:
    var(--space-img) center/cover no-repeat,
    radial-gradient(1px 1px at 10% 20%, #fff 40%, transparent 41%),
    radial-gradient(1px 1px at 30% 80%, #fff 40%, transparent 41%),
    radial-gradient(1px 1px at 70% 30%, #fff 40%, transparent 41%),
    radial-gradient(1px 1px at 90% 60%, #fff 40%, transparent 41%);
  animation: twinkle 14s linear infinite;
}
@keyframes twinkle{0%,100%{opacity:.12}50%{opacity:.22}}

/* Halo nébuleux animé */
body::after{
  content:"";
  position:fixed; inset:-10%; pointer-events:none; z-index:0; filter:blur(24px);
  background:
    radial-gradient(600px 320px at 50% 25%, rgba(0,234,255,.18), transparent 60%),
    radial-gradient(900px 420px at 50% 70%, rgba(138,43,226,.18), transparent 65%);
  animation: float 18s ease-in-out infinite alternate;
}
@keyframes float{from{transform:translateY(-1.5%)}to{transform:translateY(1.5%)}}

/* Zone schéma */
.stage{position:relative;width:calc(100vw - var(--sidebar-w));height:100vh;margin-left:var(--sidebar-w);display:grid;place-items:center; z-index:1}
.stage.panning, .stage.panning *{cursor:grabbing !important}

#world{position:absolute;inset:0;transform-origin:0 0;will-change:transform}

/* Fils */
#wires{position:absolute;inset:0;width:100%;height:100%}
#wires line{
  cursor:pointer; transition:stroke .12s ease, stroke-width .12s ease, filter .12s ease;
  stroke: rgba(0,234,255,.55); stroke-width:2; stroke-linecap:round;
  filter: drop-shadow(0 0 6px rgba(0,234,255,.35));
}
#wires line:hover{ stroke:#ff5ea0; stroke-width:3; filter: drop-shadow(0 0 10px rgba(255,94,160,.6)); }

/* Cercles / nœuds */
.node{
  position:absolute;width:110px;height:110px;border-radius:9999px;
  background: var(--node, var(--primary)); color:#fff;
  display:flex;align-items:center;justify-content:center;font-weight:700;text-align:center;padding:10px;
  cursor:grab; transition:transform .12s ease,box-shadow .12s ease,filter .12s ease; will-change:transform,left,top;
  border:1px solid color-mix(in oklab, var(--node, var(--primary)), white 15%);
  box-shadow:
    0 0 0 3px color-mix(in oklab, var(--node, var(--primary)), black 75%),
    0 0 28px color-mix(in oklab, var(--node, var(--primary)), white 10%);
}
.node:active{cursor:grabbing}
.node:hover{
  filter: var(--glow);
  box-shadow:
    0 0 0 3px color-mix(in oklab, var(--node, var(--primary)), black 65%),
    0 0 42px color-mix(in oklab, var(--node, var(--primary)), white 20%);
  transform: translateY(-1px);
}
.node.selected{
  outline:unset;
  box-shadow:
    0 0 0 4px color-mix(in oklab, var(--node, var(--primary)), white 35%),
    0 0 60px color-mix(in oklab, var(--node, var(--primary)), white 25%);
}
/* Cibles d'accroche / câblage (patch) */
.node.snap-target{
  box-shadow: 0 0 0 5px rgba(138,43,226,.45), 0 0 36px rgba(138,43,226,.45);
  filter: var(--glow);
}
.node.wire-source{
  box-shadow: 0 0 0 5px rgba(0,234,255,.5), 0 0 36px rgba(0,234,255,.4);
}
.node.connectable{
  outline: 2px dashed rgba(234,255,255,.25);
  outline-offset: 2px;
}

.node .label{
  pointer-events:none;line-height:1.1;width:100%;max-width:100%;overflow:hidden;word-break:break-word;hyphens:auto;
  text-shadow: 0 0 8px rgba(0,0,0,.45);
}

/* Badges */
.url-badge{
  position:absolute; right:-6px; bottom:-6px; width:22px; height:22px; border-radius:9999px;
  border:1px solid rgba(255,255,255,.18); background:rgba(10,16,36,.8);
  backdrop-filter: blur(6px);
  box-shadow: 0 0 8px rgba(0,234,255,.35);
  display:flex; align-items:center; justify-content:center; font-size:12px; color:#eaffff; text-decoration:none;
  transition: filter .15s ease, transform .15s ease;
}
.url-badge:hover{ filter: var(--glow); transform: translateY(-1px); }

.task-badge{
  position:absolute; right:-6px; top:-6px; width:22px; height:22px; border-radius:9999px;
  border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.08);
  box-shadow: 0 0 8px rgba(255,215,0,.4); color:#ffd700; display:flex; align-items:center; justify-content:center; font-size:12px; user-select:none;
}

/* Menus (contextuels) */
.menu{
  position:fixed;display:none;flex-direction:column;min-width:300px;
  background: rgba(6,10,24,.72);
  border:1px solid rgba(255,255,255,.08); border-radius:14px;
  box-shadow:0 20px 40px rgba(0,0,0,.35); overflow:hidden; z-index:70; backdrop-filter: blur(10px);
}
.menu-body{display:flex;flex-direction:column}
.menu button{
  appearance:none;background:transparent;border:0;text-align:left;padding:12px 14px;font-size:14px;cursor:pointer;color:var(--text);
  border-radius:10px; margin:2px 6px; transition: background .15s ease, filter .15s ease;
}
.menu button:hover{ background: linear-gradient(90deg, rgba(0,234,255,.08), rgba(138,43,226,.06)); filter: var(--glow); }
.menu .row{
  display:flex;align-items:center;gap:10px;padding:10px 12px;border-top:1px solid rgba(255,255,255,.08)
}
.menu .row label{font-size:12px;color:var(--muted)}
.menu .row input[type="color"]{
  width:36px;height:28px;border:1px solid rgba(255,255,255,.12);border-radius:6px;padding:0;background:transparent;cursor:pointer
}
.menu select,.menu input[type="number"],.menu input[type="text"]{
  height:28px;border:1px solid rgba(255,255,255,.12);border-radius:8px;padding:0 8px;background:rgba(8,12,28,.6);color:var(--text)
}
.menu .toggle-group{display:flex;gap:8px}
.menu .toggle{
  padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:8px;cursor:pointer;background:transparent;color:var(--text)
}
.menu .toggle[aria-pressed="true"]{ background:#0b1120; box-shadow: var(--ring); }
.menu-spacer{flex:1 1 auto}
.menu-footer{display:flex;gap:8px;justify-content:flex-end;padding:8px 10px;border-top:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03)}

/* Boutons icône */
.icon-btn{
  width:36px;height:36px;border-radius:10px;border:1px solid transparent;cursor:pointer;
  display:flex;align-items:center;justify-content:center;font-size:18px;color:var(--text);
  background:
    linear-gradient(#0c1327,#0b1120) padding-box,
    conic-gradient(from 180deg, rgba(0,234,255,.8), rgba(138,43,226,.8), rgba(0,234,255,.8)) border-box;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 8px 24px rgba(0,0,0,.45);
  transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
}
.icon-btn:hover{ transform: translateY(-2px); filter: var(--glow); }
.icon-btn.small{width:28px;height:28px;font-size:14px;border-radius:8px}
.icon-btn.star{color:#ffd700}

/* Toolbar */
.toolbar{
  position:fixed;right:16px;top:16px;display:flex;gap:8px;
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.06);
  border-radius:14px;padding:8px;
  box-shadow:0 8px 24px rgba(0,0,0,.35);z-index:65; backdrop-filter: blur(8px);
}
.toolbar button{
  padding:10px 14px;border:1px solid transparent;border-radius:12px;cursor:pointer;color:var(--text);
  background:
    linear-gradient(#0c1327,#0b1120) padding-box,
    conic-gradient(from 180deg, rgba(0,234,255,.8), rgba(138,43,226,.8), rgba(0,234,255,.8)) border-box;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 8px 24px rgba(0,0,0,.45);
  transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
  font-weight:600; letter-spacing:.02em;
}
.toolbar button:hover{ transform: translateY(-2px); filter: var(--glow); }
.toolbar button.secondary{ opacity:.9 }
.toolbar button.danger{ filter: drop-shadow(0 0 8px rgba(255,40,40,.35)); }
.toolbar button.active{ box-shadow: var(--ring); }

/* Menus 1 & 2 (sidebars) */
.sidebar{
  position:fixed;left:0;top:0;bottom:0;width:var(--sidebar-w);
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border-right:1px solid rgba(255,255,255,.06);
  box-shadow:0 8px 24px rgba(0,0,0,.35);
  padding:12px;overflow:auto;z-index:80; backdrop-filter: blur(8px);
}
.sidebar2{
  position:fixed;left:var(--sidebar-w);top:0;bottom:0;width:260px;
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border-right:1px solid rgba(255,255,255,.06);
  box-shadow:0 8px 24px rgba(0,0,0,.35);
  padding:12px;overflow:auto;z-index:80;display:none; backdrop-filter: blur(8px);
}

.side-item{
  width:100%;text-align:left;padding:12px 14px;border:0;border-radius:12px;background:transparent;color:var(--text);
  font-weight:700;cursor:pointer;margin-bottom:8px;
  transition: background .15s ease, filter .15s ease;
}
.side-item:hover{ background: linear-gradient(90deg, rgba(0,234,255,.08), rgba(138,43,226,.06)); filter: var(--glow); }
/* Patch: style danger manquant */
.side-item.danger{ color:#ff9ca3 }
.side-item.danger:hover{ background: linear-gradient(90deg, rgba(255,70,70,.08), rgba(255,90,90,.06)); filter: drop-shadow(0 0 8px rgba(255,70,70,.35)); }

.child-list{list-style:none;padding-left:10px;margin:6px 0 12px}
.child-list li{
  padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);
  background: rgba(255,255,255,.03);margin-bottom:6px;font-size:13px;cursor:pointer;color:var(--text);
  transition: background .15s ease, filter .15s ease;
}
.child-list li:hover{ background: rgba(255,255,255,.06); filter: var(--glow); }

/* Croix fermeture Menu 2 */
#closeMenu2{
  position:sticky; top:0; float:right; width:26px; height:26px; border-radius:8px; cursor:pointer; font-weight:700; margin-left:auto;
  border:1px solid transparent; color:var(--text);
  background:
    linear-gradient(#0c1327,#0b1120) padding-box,
    conic-gradient(from 180deg, rgba(0,234,255,.8), rgba(138,43,226,.8), rgba(0,234,255,.8)) border-box;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 8px 24px rgba(0,0,0,.35);
  transition: transform .2s ease, filter .2s ease;
}
#closeMenu2:hover{ transform: translateY(-2px); filter: var(--glow); }

/* Rows, labels, inputs, toggles (Menu 2 style aligné Menu 3) */
#actions .row{display:flex;align-items:center;gap:10px;padding:10px 12px;border-top:1px solid rgba(255,255,255,.08)}
#actions .row:first-of-type{border-top:none}
#actions .row label{font-size:12px;color:var(--muted);min-width:90px}
#actions input[type="color"]{width:36px;height:28px;border:1px solid rgba(255,255,255,.12);border-radius:6px;padding:0;background:transparent;cursor:pointer}
#actions select,#actions input[type="number"],#actions input[type="text"]{
  height:28px;border:1px solid rgba(255,255,255,.12);border-radius:8px;padding:0 8px;background:rgba(8,12,28,.6);color:var(--text)
}
#actions .toggle-group{display:flex;gap:8px}
#actions .toggle{padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:8px;cursor:pointer;background:transparent;color:var(--text)}
#actions .toggle[aria-pressed="true"]{ background:#0b1120; box-shadow: var(--ring); }

/* Boutons bas-droite */
.home-btn{
  position:fixed;bottom:16px;width:44px;height:44px;border-radius:9999px;cursor:pointer;font-size:20px;z-index:65;color:var(--text);
  border:1px solid transparent;
  background:
    linear-gradient(#0c1327,#0b1120) padding-box,
    conic-gradient(from 180deg, rgba(0,234,255,.8), rgba(138,43,226,.8), rgba(0,234,255,.8)) border-box;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 8px 24px rgba(0,0,0,.45);
  transition: transform .2s ease, filter .2s ease;
}
.home-btn:hover{ transform: translateY(-2px); filter: var(--glow); }
#homeBtn{right:16px}
#tasksBtn{right:70px}

/* Modales */
.modal{position:fixed;inset:0;background:rgba(3,6,16,.55);display:none;align-items:center;justify-content:center;z-index:90;backdrop-filter: blur(2px)}
.modal .card{
  width:min(520px,calc(100vw - 32px));max-height:80vh;overflow:auto;
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.06); border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.35); padding:14px; color:var(--text);
  backdrop-filter: blur(8px);
}
.modal .card h3{margin:4px 0 10px 0; font-family: Orbitron, sans-serif; letter-spacing:.06em}
.modal .row{display:flex;gap:10px;margin:8px 0}
.modal label{font-size:12px;color:var(--muted);min-width:90px}
.modal input,.modal textarea{
  flex:1;border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px 12px;font:inherit;background:rgba(8,12,28,.6);color:var(--text)
}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

/* Boutons génériques */
.btn{
  padding:10px 14px;border-radius:12px;border:1px solid transparent;cursor:pointer;color:var(--text);
  background:
    linear-gradient(#0c1327,#0b1120) padding-box,
    conic-gradient(from 180deg, rgba(0,234,255,.8), rgba(138,43,226,.8), rgba(0,234,255,.8)) border-box;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 8px 24px rgba(0,0,0,.45);
  transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
}
.btn:hover{ transform: translateY(-2px); filter: var(--glow); }
.btn.secondary{opacity:.9}

/* Liste & tâches */
.list{display:flex;flex-direction:column;gap:8px;margin-top:6px}
.task-item{
  border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:10px;background:rgba(255,255,255,.03);color:var(--text)
}
.task-item small{color:var(--muted)}
.dot{
  display:inline-block;width:10px;height:10px;border-radius:9999px;border:1px solid rgba(255,255,255,.12);margin-right:6px;vertical-align:middle
}

/* Pulse sélection */
@keyframes pulseNode{0%{box-shadow:0 0 0 0 rgba(0,234,255,.35)}100%{box-shadow:0 0 0 6px rgba(0,234,255,0)}}
.node.pulse{animation:pulseNode 600ms ease-out 2}

/* Accessibilité */
@media (prefers-reduced-motion: reduce){
  *{ animation:none!important; transition:none!important }
}
